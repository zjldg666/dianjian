if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}const n=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n};const o=n({data:()=>({strAccount:"",password:"",clientCodes:[],selectedClientCode:""}),onLoad(){this.loadClientCodes()},methods:{loadClientCodes(){uni.request({url:"http://13.94.38.44:8080/CheckList/GetClientCode",method:"GET",success:e=>{const n=JSON.parse(e.data);n&&n.list?(this.clientCodes=n.list.map((e=>e.ClientCode)),t("log","at pages/login/login.vue:44","加载成功:",this.clientCodes)):t("error","at pages/login/login.vue:46","加载客户编码失败:",n?n.message:"无效的返回数据")},fail:e=>{t("error","at pages/login/login.vue:50","加载客户编码失败",e)}})},handleClientCodeChange(e){this.selectedClientCode=this.clientCodes[e.detail.value]},login(){this.strAccount&&this.password&&this.selectedClientCode?uni.request({url:"http://13.94.38.44:8080/CheckList/SignIn",method:"POST",data:{strAccount:this.strAccount,strPswd:this.password,clientcode:this.selectedClientCode},success:e=>{const n=JSON.parse(e.data);t("log","at pages/login/login.vue:71","数据为:",n),!1===n.IsError?(t("log","at pages/login/login.vue:73","数据为:",n),uni.setStorageSync("token",n.token),uni.setStorageSync("username",n.userName),uni.setStorageSync("clientcode",this.selectedClientCode),uni.showToast({title:"登录成功",icon:"success"}),uni.redirectTo({url:"/pages/home/home"})):uni.showToast({title:"用户名或密码错误",icon:"none"})},fail:e=>{t("error","at pages/login/login.vue:93","登录失败",e),uni.showToast({title:"登录失败，请稍后重试",icon:"none"})}}):uni.showToast({title:"请输入完整的登录信息",icon:"none",complete:()=>{uni.reLaunch({url:"/pages/login/login"})}})}}},[["render",function(t,n,o,s,a,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"login-box"},[e.createElementVNode("view",{class:"title"},"用户登录"),e.createElementVNode("picker",{mode:"selector",range:a.clientCodes,onChange:n[0]||(n[0]=(...e)=>r.handleClientCodeChange&&r.handleClientCodeChange(...e))},[e.createElementVNode("view",{class:"picker"},e.toDisplayString(a.selectedClientCode||"选择客户编码"),1)],40,["range"]),e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:" 账号","onUpdate:modelValue":n[1]||(n[1]=e=>a.strAccount=e),class:"input"},null,512),[[e.vModelText,a.strAccount]]),e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"密码","onUpdate:modelValue":n[2]||(n[2]=e=>a.password=e),class:"input"},null,512),[[e.vModelText,a.password]]),e.createElementVNode("button",{onClick:n[3]||(n[3]=(...e)=>r.login&&r.login(...e)),class:"button"},"登录")])])}]]);const s=n({props:{username:String}},[["render",function(t,n,o,s,a,r){return e.openBlock(),e.createElementBlock("view",{class:"navbar"},[e.createElementVNode("view",{class:"logoBox"},[e.createElementVNode("image",{class:"logo",src:"/static/logo.png",mode:"heightFix"})]),e.createElementVNode("view",{class:"username"},e.toDisplayString(o.username),1),e.createElementVNode("button",{onClick:n[0]||(n[0]=e=>t.$emit("logout")),class:"nabutton"},"退出")])}],["__scopeId","data-v-2049fc75"]]);const a=n({props:{buttons:{typs:Array,required:!0}},methods:{handleClick(e){"function"==typeof e&&e()}}},[["render",function(t,n,o,s,a,r){return e.openBlock(),e.createElementBlock("view",{class:"button-group"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.buttons,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"ZujianButton-item"},[e.createElementVNode("button",{disabled:t.disabled,onClick:e=>r.handleClick(t.action),class:"ZujianButton"},e.toDisplayString(t.label),9,["disabled","onClick"])])))),128))])}],["__scopeId","data-v-8b5f2c6f"]]);const r=n({components:{Navbar:s,ButtonGroup:a},data:()=>({username:uni.getStorageSync("username")||"",buttons:[]}),onLoad(){this.getInspectionItems()},onPullDownRefresh(){this.getInspectionItems((()=>{uni.stopPullDownRefresh()}))},methods:{getInspectionItems(e){const n=uni.getStorageSync("token"),o=uni.getStorageSync("clientcode");uni.request({url:"http://13.94.38.44:8080/CheckList/GetAllCheckListByClientCode",method:"POST",data:{code:o,token:n},success:o=>{const s=JSON.parse(o.data);t("log","at pages/inspection/inspection.vue:50","token:",n),s.isError?t("error","at pages/inspection/inspection.vue:59","加载点检项目失败:",s.message):(this.buttons=s.list.map((e=>({label:e.SEL_ShuoMing,action:()=>this.goToDetail(e.SEL_TXT,e.SEL_ShuoMing)}))),t("log","at pages/inspection/inspection.vue:57","点检项目加载成功:",this.buttons)),e&&e()},fail:n=>{t("error","at pages/inspection/inspection.vue:63","加载点检项目失败",n),e&&e()}})},goToDetail(e,t){uni.navigateTo({url:`/pages/detail/detail?selTxt=${e}&&selShuoMing=${t}`})},logout(){uni.removeStorageSync("username"),uni.redirectTo({url:"/pages/login/login"})}}},[["render",function(t,n,o,s,a,r){const i=e.resolveComponent("navbar"),l=e.resolveComponent("button-group");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(i,{username:a.username,onLogout:r.logout},null,8,["username","onLogout"]),e.createElementVNode("view",{class:"content"},[e.createVNode(l,{buttons:a.buttons},null,8,["buttons"])])])}]]);const i=n({components:{Navbar:s},data:()=>({username:uni.getStorageSync("username")||"",inspectionDetails:[],selTxt:"",selShuoMing:""}),onLoad(e){this.selTxt=e.selTxt,this.selShuoMing=e.selShuoMing},methods:{scanQRCode(){uni.scanCode({success:e=>{t("log","at pages/detail/detail.vue:49","扫描成功",e),this.verifyQRCode(e.result)},fail:e=>{t("error","at pages/detail/detail.vue:53","扫描失败",e)}})},verifyQRCode(e){const t=e.substring(0,3).toLowerCase();t===this.selTxt.toLowerCase()?(uni.showToast({title:"巡查点正确",icon:"success"}),this.loadInspectionDetails(t)):uni.showToast({title:"位置不匹配",icon:"none"})},loadInspectionDetails(e){const n=uni.getStorageSync("token");uni.request({url:"http://13.94.38.44:8080/CheckList/GetCheckListDetail",method:"POST",data:{code:e,token:n},success:n=>{const o=JSON.parse(n.data);o.isError?t("error","at pages/detail/detail.vue:93","加载点检详情失败:",o.message):(this.inspectionDetails=o.dt,t("log","at pages/detail/detail.vue:87","点检详情加载成功:",this.inspectionDetails),uni.navigateTo({url:`/pages/project/project?id=${e}&name=${this.selShuoMing}`}))},fail:e=>{t("error","at pages/detail/detail.vue:97","加载点检详情失败",e)}})},logout(){uni.removeStorageSync("username"),uni.redirectTo({url:"/pages/login/login"})}}},[["render",function(t,n,o,s,a,r){const i=e.resolveComponent("navbar");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(i,{username:a.username,onLogout:r.logout},null,8,["username","onLogout"]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"inspection-point"},[e.createElementVNode("view",{class:"inspection-name"},"检查位置>"+e.toDisplayString(a.selShuoMing),1),e.createElementVNode("view",{class:"scanner"},[e.createElementVNode("view",{class:"scanner-animation"})]),e.createElementVNode("button",{onClick:n[0]||(n[0]=(...e)=>r.scanQRCode&&r.scanQRCode(...e)),class:"button"},"点击扫描二维码")])])])}]]);const l=n({components:{Navbar:s,ButtonGroup:a},data(){return{username:uni.getStorageSync("username")||"",buttons:[{label:"我的巡查",action:this.goToInspection},{label:"待定按钮1",action:null,disabled:!0},{label:"待定按钮2",action:null,disabled:!0},{label:"待定按钮3",action:null,disabled:!0}]}},methods:{goToInspection(){uni.navigateTo({url:"/pages/inspection/inspection"})},logout(){uni.removeStorageSync("username"),uni.redirectTo({url:"/pages/login/login"})}}},[["render",function(t,n,o,s,a,r){const i=e.resolveComponent("navbar"),l=e.resolveComponent("button-group");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(i,{username:a.username,onLogout:r.logout},null,8,["username","onLogout"]),e.createElementVNode("view",{class:"content"},[e.createVNode(l,{buttons:a.buttons},null,8,["buttons"])])])}]]);const c=n({components:{Navbar:s},data:()=>({username:uni.getStorageSync("username")||"",inspectionPoint:{id:"",name:""},inspectionItems:[],currentItemIndex:0,currentProject:""}),onLoad(e){this.inspectionPoint.id=e.id,this.inspectionPoint.name=e.name;const t=uni.getStorageSync("token");this.loadInspectionDetails(this.inspectionPoint.id,t)},onPullDownRefresh(){const e=this.inspectionPoint.id,n=uni.getStorageSync("token");if(!e)return t("error","at pages/project/project.vue:149","id 参数为空"),void uni.stopPullDownRefresh();this.loadInspectionDetails(e,n,(()=>{uni.stopPullDownRefresh()}))},computed:{currentItem(){return this.inspectionItems[this.currentItemIndex]||null}},methods:{loadInspectionDetails(e,n,o){e?(t("log","at pages/project/project.vue:170","请求参数:",{code:e,token:n}),uni.request({url:"http://13.94.38.44:8080/CheckList/GetCheckListDetail",method:"POST",data:{code:e,token:n},success:e=>{var n;const s=JSON.parse(e.data);s.isError?t("error","at pages/project/project.vue:190","加载点检详情失败:",s.message):(this.inspectionItems=s.dt.map((e=>({...e,remarks:"",images:[],flag:""}))),this.currentProject=(null==(n=this.inspectionItems[0])?void 0:n.Project)||"",t("log","at pages/project/project.vue:188","点检详情加载成功:",this.inspectionItems)),o&&o()},fail:e=>{t("error","at pages/project/project.vue:195","加载点检详情失败:",e),o&&o()}})):t("error","at pages/project/project.vue:167","id 参数为空")},handleFlagChange(e){this.currentItem.flag=e},prevItem(){this.currentItemIndex>0&&(this.currentItemIndex--,this.currentProject=this.inspectionItems[this.currentItemIndex].Project)},nextOrFinishItem(){this.currentItem.flag?this.currentItemIndex<this.inspectionItems.length-1?this.nextItem():(t("log","at pages/project/project.vue:217","当前 inspectionItems:",this.inspectionItems),this.saveInspection()):uni.showToast({title:"请先选择结果",icon:"none"})},nextItem(){this.currentItemIndex<this.inspectionItems.length-1&&(this.currentItemIndex++,this.currentProject=this.inspectionItems[this.currentItemIndex].Project)},uploadImage(){uni.chooseImage({count:9,success:e=>{e.tempFilePaths.length>0&&(this.currentItem.images||this.$set(this.currentItem,"images",[]),this.convertImagesToBase64(e.tempFilePaths))},fail:e=>{t("error","at pages/project/project.vue:247","选择图片失败:",e)}})},convertImagesToBase64(e){Promise.all(e.map((e=>function(e,t="png"){return"string"!=typeof e||""===e.trim()?Promise.reject(new Error("Invalid URL")):new Promise(((n,o)=>{e.startsWith("http")?uni.request({url:e,method:"GET",responseType:"arraybuffer",success:e=>{const o=`data:image/${t};base64,${uni.arrayBufferToBase64(e.data)}`;n(o)},fail:e=>{o(new Error(`Request failed: ${e}`))}}):uni.compressImage({src:e,quality:100,success:e=>{const t=e.tempFilePath;plus.io.resolveLocalFileSystemURL(t,(e=>{e.file((e=>{let t=new plus.io.FileReader;t.onload=e=>{n(e.target.result)},t.readAsDataURL(e)}),(e=>{o(new Error(`File resolution failed: ${e}`))}))}),(e=>{o(new Error(`File resolution failed: ${e}`))}))},fail:e=>{o(new Error(`Compress image failed: ${e}`))}})}))}(e)))).then((e=>{this.currentItem.images.push(...e),t("log","at pages/project/project.vue:256","Base64 图片路径:",this.currentItem.images)})).catch((e=>{t("error","at pages/project/project.vue:258","转换图片为 Base64 编码失败:",e)}))},deleteImage(e){this.currentItem.images.splice(e,1)},saveInspection(){if(!this.inspectionItems||!this.inspectionItems.length)return void t("error","at pages/project/project.vue:268","inspectionItems 未定义或为空");uni.showLoading({title:"正在上传数据..."});const e=uni.getStorageSync("token"),n={token:e,list:this.inspectionItems.map((e=>{const t=new Date,n=`${t.getFullYear()}:${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}:${String(t.getHours()).padStart(2,"0")}${String(t.getMinutes()).padStart(2,"0")}${String(t.getSeconds()).padStart(2,"0")}`;return{ID:e.ID,Time:n,Flag:e.flag||"NG",FileList:(e.images||[]).map((e=>e)),Remark:e.remarks||""}}))};t("log","at pages/project/project.vue:292","发送到 SaveDetail 接口的数据:",n),uni.request({url:"http://13.94.38.44:8080/CheckList/SaveDetail",method:"POST",header:{"content-type":"application/json"},data:n,success:n=>{if(t("log","at pages/project/project.vue:302","第一次请求返回数据为:",n.data),"string"==typeof n.data)try{const o=JSON.parse(n.data);if(o.isError)uni.showToast({title:o.msg||"保存失败",icon:"none"}),t("error","at pages/project/project.vue:314","保存点检详情失败:",o.msg);else{const t=o.docnum;this.saveFinalResult(t,e)}}catch(o){t("error","at pages/project/project.vue:317","解析第一次请求返回数据时出错:",o)}else t("error","at pages/project/project.vue:320","第一次请求响应数据不是字符串:",n.data)},fail:e=>{t("error","at pages/project/project.vue:324","保存点检详情失败:",e)}})},saveFinalResult(e,n){uni.request({url:"http://13.94.38.44:8080/CheckList/SaveDetail2",method:"POST",data:{docnum:e,token:n},success:e=>{if(t("log","at pages/project/project.vue:338","第二次请求返回数据为:",e.data),"string"==typeof e.data)try{const n=JSON.parse(e.data);n.IsError?(uni.showToast({title:n.msg,icon:"none"}),t("error","at pages/project/project.vue:355","保存检查结果失败:",n.msg)):(uni.showToast({title:"检查成功",icon:"success"}),uni.redirectTo({url:"/pages/inspection/inspection"}))}catch(n){t("error","at pages/project/project.vue:358","解析第二次请求返回数据时出错:",n)}else t("error","at pages/project/project.vue:361","第二次请求响应数据不是字符串:",e.data)},fail:e=>{t("error","at pages/project/project.vue:365","保存检查结果失败:",e)}})},logout(){uni.removeStorageSync("username"),uni.redirectTo({url:"/pages/login/login"})}}},[["render",function(t,n,o,s,a,r){const i=e.resolveComponent("navbar");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createVNode(i,{username:a.username,onLogout:r.logout},null,8,["username","onLogout"]),e.createElementVNode("view",{class:"title"},e.toDisplayString(a.inspectionPoint.name)+" > "+e.toDisplayString(a.currentProject),1),e.createElementVNode("view",{class:"content"},[r.currentItem?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"item"},[e.createElementVNode("view",{class:"item-title"},e.toDisplayString(r.currentItem.Description),1),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",null,"选择结果："),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{class:e.normalizeClass({selButton:!0,selected:"OK"===r.currentItem.flag}),onClick:n[0]||(n[0]=e=>r.handleFlagChange("OK"))},[e.createElementVNode("image",{src:"/static/dui.png",class:"icon-image"})],2),e.createElementVNode("button",{class:e.normalizeClass({selButton:!0,selected:"有问题，但已经解决"===r.currentItem.flag}),onClick:n[1]||(n[1]=e=>r.handleFlagChange("有问题，但已经解决"))},[e.createElementVNode("image",{src:"/static/NT.png",class:"icon-image"})],2),e.createElementVNode("button",{class:e.normalizeClass({selButton:!0,selected:"NG"===r.currentItem.flag}),onClick:n[2]||(n[2]=e=>r.handleFlagChange("NG"))},[e.createElementVNode("image",{src:"/static/cuo.png",class:"icon-image"})],2)])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",null,"点检说明："),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=e=>r.currentItem.remarks=e),class:"input"},null,512),[[e.vModelText,r.currentItem.remarks]])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("label",null,"上传图片："),e.createElementVNode("button",{onClick:n[4]||(n[4]=(...e)=>r.uploadImage&&r.uploadImage(...e)),class:"button"},"+"),r.currentItem.images&&r.currentItem.images.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.currentItem.images,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"image-preview"},[e.createElementVNode("image",{src:t,class:"preview-image"},null,8,["src"]),e.createElementVNode("button",{onClick:e=>r.deleteImage(n),class:"delete-button"},"X",8,["onClick"])])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{onClick:n[5]||(n[5]=(...e)=>r.prevItem&&r.prevItem(...e)),disabled:0===a.currentItemIndex,class:"button"},"上一项",8,["disabled"]),e.createElementVNode("button",{onClick:n[6]||(n[6]=(...e)=>r.nextOrFinishItem&&r.nextOrFinishItem(...e)),class:"button"},e.toDisplayString(a.currentItemIndex===a.inspectionItems.length-1?"点检成功":"下一项"),1)])])])):(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("view",{class:"message"},"所有点检项目完成")]))])])}],["__scopeId","data-v-1bbb8ed3"]]);__definePage("pages/login/login",o),__definePage("pages/inspection/inspection",r),__definePage("pages/detail/detail",i),__definePage("pages/home/home",l),__definePage("components/Navbar",s),__definePage("pages/project/project",c);const u=n({components:{Navbar:s},data:()=>({username:uni.getStorageSync("username")||"",showNavbar:!1}),onShow(){this.checkCurrentPage()},methods:{checkCurrentPage(){const e=getCurrentPages();if(e.length>0){const t=e[e.length-1].route;this.showNavbar="pages/login/login"!==t}},logout(){uni.removeStorageSync("username"),uni.redirectTo({url:"/pages/login/login"})}}},[["render",function(t,n,o,s,a,r){const i=e.resolveComponent("navbar");return e.openBlock(),e.createElementBlock("view",{class:"app"},[a.showNavbar?(e.openBlock(),e.createBlock(i,{key:0,username:a.username,onLogout:r.logout},null,8,["username","onLogout"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content"},[e.renderSlot(t.$slots,"default",{},void 0,!0)])])}],["__scopeId","data-v-f73dc907"]]);const{app:p,Vuex:d,Pinia:g}={app:e.createVueApp(u)};uni.Vuex=d,uni.Pinia=g,p.provide("__globalStyles",__uniConfig.styles),p._component.mpType="app",p._component.render=()=>{},p.mount("#app")}(Vue);
