{"version":3,"file":"YiChang.js","sources":["pages/YiChang/YiChang.vue","../../../../Download/HBuilder-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvWWlDaGFuZy9ZaUNoYW5nLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <navbar :username=\"username\" @logout=\"logout\" />\n\t\n    <view class=\"content\">\n      <!-- 使用 Loading 组件 -->\n      <loading-spinner :show=\"isLoading\" />\n\t\t\n      <view v-if=\"!isLoading && details.length > 0\">\n        <view class=\"header\">{{ selShuoMing }}</view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检项目:</text>\n          <text class=\"value\">{{ currentDetail?.Project }}</text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检内容:</text>\n          <text class=\"value\">{{ currentDetail?.Description }}</text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检结果:</text>\n          <text class=\"value\">\n            <span v-if=\"currentDetail?.Result === '1'\"><image src=\"../../static/dui.png\" class=\"Fuhao\"></image></span>\n            <span v-else-if=\"currentDetail?.Result === '3'\"><image src=\"../../static/NT.png\" class=\"Fuhao\"></image></span>\n            <span v-else-if=\"currentDetail?.Result === '2'\"><image src=\"../../static/cuo.png\" class=\"Fuhao\"></image></span>\n          </text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检说明:</text>\n          <text class=\"value\">{{ currentDetail?.Remark }}</text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检人:</text>\n          <text class=\"value\">{{ currentDetail?.Person }}</text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">点检时间:</text>\n          <text class=\"value\">{{ currentDetail?.Time1 }}</text>\n        </view>\n        <view class=\"detail-item\">\n          <text class=\"label\">设备时间:</text>\n          <text class=\"value\">{{ currentDetail?.Time3 }}</text>\n        </view>\n        <view class=\"images-container\">\n          <image \n            v-for=\"(image, index) in currentDetail?.FileLists || []\" \n            :key=\"index\" \n            :src=\"'data:image/png;base64,' + image\" \n            class=\"image\"\n            @click=\"previewImage(index)\"\n          ></image>\n        </view>\n        <view class=\"navigation-buttons\">\n          <button :disabled=\"currentIndex === 0\" @click=\"prevItem\">上一个</button>\n          <button :disabled=\"currentIndex === details.length - 1\" @click=\"nextItem\">下一个</button>\n        </view>\n      </view>\n      \n      <!-- 无数据提示 -->\n      <view v-else-if=\"!isLoading && details.length === 0\" class=\"no-data\">\n        暂无数据\n      </view>\n    </view>\n <image-viewer \r\n   v-if=\"isPreviewVisible\"\r\n   :is-preview-visible=\"isPreviewVisible\" \r\n   :current-image=\"currentDetail?.FileLists ? (currentDetail.FileLists[currentPreviewIndex] || '') : ''\" \r\n   @update:is-preview-visible=\"isPreviewVisible = $event\"\r\n />\n  </view>\n</template>\n\n<script>\nimport { ref, computed } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport Navbar from '@/components/Navbar.vue';\nimport ImageViewer from '@/components/ImageViewer.vue';\nimport LoadingSpinner from '@/components/LoadingSpinner.vue';\n\nexport default {\n  name: 'DetailPage',\n  components: {\n    Navbar,\n    ImageViewer,\n    LoadingSpinner\n  },\n  setup() {\n    const username = ref(uni.getStorageSync('username') || '');\n    const details = ref([]);\n    const currentIndex = ref(0);\n    const selShuoMing = ref('');\n    const isPreviewVisible = ref(false);\n    const currentPreviewIndex = ref(0);\n    const isLoading = ref(true);\n\n    const currentDetail = computed(() => {\n      return details.value[currentIndex.value] || {};\n    });\n\n    const logout = () => {\n      uni.removeStorageSync('username');\n      uni.redirectTo({\n        url: '/pages/login/login'\n      });\n    };\n\n    const getRemindDetail = (code, token) => {\n      // 显示加载状态\n      isLoading.value = true;\n      console.log('开始加载数据，isLoading:', isLoading.value);\n\n      const requestData = { token, code };\n      uni.request({\n        url: 'http://13.94.38.44:8080/CheckList/GetRemindDetail',\n        method: 'POST',\n        data: requestData,\n        success: (response) => {\n          console.log('请求成功，响应数据:', response);\n          const data = JSON.parse(response.data);\n          console.log('解析后数据:', data);\n          if (!data.isError) {\n            details.value = data.list || [];\n            currentIndex.value = 0;\n            console.log('数据加载完成，details长度:', details.value.length);\n          } else {\n            uni.showToast({\n              title: '加载提醒详情失败',\n              icon: 'none'\n            });\n            details.value = [];\n          }\n        },\n        fail: (error) => {\n          console.error('加载提醒详情失败', error);\n          uni.showToast({\n            title: '加载提醒详情失败',\n            icon: 'none'\n          });\n          details.value = [];\n        },\n        complete: () => {\n          // 隐藏加载状态\n          isLoading.value = false;\n          console.log('加载完成，isLoading:', isLoading.value);\n        }\n      });\n    };\n\n    const prevItem = () => {\n      if (currentIndex.value > 0) {\n        currentIndex.value--;\n      }\n    };\n\n    const nextItem = () => {\n      if (currentIndex.value < details.value.length - 1) {\n        currentIndex.value++;\n      }\n    };\n\n    const previewImage = (index) => {\n      console.log('Clicked image index:', index);\n      console.log('Images array:', currentDetail.value.FileLists);\n      currentPreviewIndex.value = index;\n      isPreviewVisible.value = true;\n    };\n\n    onLoad((options) => {\n      console.log('页面加载参数:', options);\n      if (options && options.id && options.token && options.selShuoMing) {\n        getRemindDetail(options.id, options.token);\n        selShuoMing.value = decodeURIComponent(options.selShuoMing);\n      } else {\n        console.error('未找到 id 或 token 参数');\n        isLoading.value = false; // 确保加载状态关闭\n      }\n    });\n\n    return {\n      username,\n      details,\n      currentIndex,\n      selShuoMing,\n      isPreviewVisible,\n      currentPreviewIndex,\n      currentDetail,\n      logout,\n      prevItem,\n      nextItem,\n      previewImage,\n      isLoading\n    };\n  }\n};\n</script>\n\n<style>\n.container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: white;\n  position: relative;\n}\n\n.content {\n  flex: 1;\n  padding: 40rpx;\n  position: relative;\n}\n\n.header {\n  font-size: 48rpx;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n}\n\n.detail-item {\n  margin-bottom: 20rpx;\n}\n\n.label {\n  font-weight: bold;\n  margin-right: 20rpx;\n}\n\n.images-container {\n  position: relative;\n  display: inline-block;\n  margin: 20rpx;\n}\n\n.image {\n  width: 160rpx;\n  height: 160rpx;\n  margin-right: 20rpx;\n  cursor: pointer;\n}\n\n.navigation-buttons {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 40rpx;\n}\n\nbutton {\n  padding: 20rpx 40rpx;\n  border: none;\n  background-color: #007AFF;\n  color: white;\n  border-radius: 10rpx;\n}\n\nbutton:disabled {\n  background-color: #cccccc;\n}\n\n.Fuhao {\n  width: 25rpx;\n  height: 25rpx;\n}\n\n.no-data {\n  text-align: center;\n  padding: 40rpx;\n  color: #999;\n}\n</style>","import MiniProgramPage from 'D:/Project/HBuilderProjects/dianjianHmS/dianjian02/pages/YiChang/YiChang.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","computed","onLoad"],"mappings":"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"}