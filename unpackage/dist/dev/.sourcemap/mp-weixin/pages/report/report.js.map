{"version":3,"file":"report.js","sources":["pages/report/report.vue","../../../../Download/HBuilder-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVwb3J0L3JlcG9ydC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <navbar :username=\"username\" @logout=\"logout\"/>\n    <view class=\"content\">\n      <view class=\"date-picker-container\">\n        <button class=\"arrow-button\" @click=\"prevDay\" :disabled=\"isPrevDisabled\">《</button>\n        <picker mode=\"date\" :value=\"selectedDate\" :end=\"currentDate\" @change=\"handleDateChange\">\n          <view class=\"picker\">\n            当前选择: {{ selectedDate }}\n          </view>\n        </picker>\n        <button class=\"arrow-button\" @click=\"nextDay\" :disabled=\"isNextDisabled\">》</button>\n      </view>\n      <view v-if=\"loading\" class=\"loading\">\n        正在加载报表数据...\n      </view>\n      <view v-else-if=\"reportData && reportData.dt.length > 0\" class=\"report-data\">\n        <table>\n          <thead>\n            <tr>\n              <th>区域描述</th>\n              <th>点检位置</th>\n              <th>区域负责人</th>\n              <th>{{ selectedDate }}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr v-for=\"item in reportData.dt\" :key=\"item.点检位置\">\n              <td>{{ item['区域描述'] }}</td>\n              <td>{{ item['点检位置'] }}</td>\n              <td>{{ item['区域负责人'] }}</td>\n              <td>\n                <navigator \n                  v-if=\"item[selectedDate] === '1'\" \n                  :url=\"`/pages/detail/detail?position=${encodeURIComponent(item['点检位置'])}&time=${selectedDate}`\"\n                  hover-class=\"navigator-hover\"\n                >\n                  <button class=\"check-button\">\n                    <image src=\"../../static/dui.png\" class=\"DuiCuo\"></image>\n                  </button>\n                </navigator>\n                <navigator \n                  v-else-if=\"item[selectedDate] === '2'\" \n                  :url=\"`/pages/detail/detail?position=${encodeURIComponent(item['点检位置'])}&time=${selectedDate}`\"\n                  hover-class=\"navigator-hover\"\n                >\n                  <button class=\"check-button\">\n                    <image src=\"../../static/cuo.png\" class=\"DuiCuo\"></image>\n                  </button>\n                </navigator>\n                <navigator \n                  v-else-if=\"item[selectedDate] === '3'\" \n                  :url=\"`/pages/detail/detail?position=${encodeURIComponent(item['点检位置'])}&time=${selectedDate}`\"\n                  hover-class=\"navigator-hover\"\n                >\n                  <button class=\"check-button\">\n                    <image src=\"../../static/quanx.png\" class=\"DuiCuo\"></image>\n                  </button>\n                </navigator>\n                <span v-else class=\"centered-span\"><strong>{{ item[selectedDate] || '-' }}</strong></span>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </view>\n      <view v-else class=\"no-data\">\n        没有找到相关数据。\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport Navbar from '@/components/Navbar.vue';\nimport { ref, onMounted, watch } from 'vue';\n\nexport default {\n  components: {\n    Navbar\n  },\n  setup() {\n    const username = ref(uni.getStorageSync('username') || '');\n    const reportData = ref(null);\n    const loading = ref(true);\n    const selectedDate = ref(new Date().toISOString().split('T')[0]);\n    const currentDate = new Date().toISOString().split('T')[0];\n\n    // 缓存已加载的月份数据\n    const cachedMonthData = ref({});\n\n    // 获取某个月的第一天\n    const getFirstDayOfMonth = (date) => {\n      const [year, month] = date.split('-');\n      return `${year}-${month}-01`;\n    };\n\n    // 获取月份标识（年-月格式）\n    const getMonthKey = (date) => {\n      const [year, month] = date.split('-');\n      return `${year}-${month}`;\n    };\n\n    // 获取报表数据\n    const fetchReport = async (date) => {\n      try {\n        loading.value = true;\n\n        const monthKey = getMonthKey(date);\n        const monthRequestDate = getFirstDayOfMonth(date);\n\n        // 检查缓存中是否存在该月份的数据\n        if (cachedMonthData.value[monthKey]) {\n          // 如果缓存中有数据，直接使用\n          reportData.value = cachedMonthData.value[monthKey];\n          console.log(`使用缓存的${monthKey}月份数据`);\n          return;\n        }\n\n        const token = uni.getStorageSync('token');\n        if (!token) {\n          uni.showToast({\n            title: '未登录，请先登录',\n            icon: 'none'\n          });\n          return;\n        }\n\n        const response = await uni.request({\n          url: 'http://13.94.38.44:8080/CheckList/GetScanReport1New',\n          method: 'POST',\n           data:{\n            token: token,\n            time: monthRequestDate\n          }\n        });\n\n        const data = JSON.parse(response.data);\n        if (!data.isError) {\n          // 缓存该月份的数据\n          cachedMonthData.value[monthKey] = data;\n          reportData.value = data;\n          console.log(`报表数据加载成功并缓存: ${monthKey}`, reportData.value);\n        } else {\n          uni.showToast({\n            title: '获取报表失败',\n            icon: 'none'\n          });\n        }\n      } catch (error) {\n        console.error('获取报表失败', error);\n        uni.showToast({\n          title: '获取报表失败',\n          icon: 'none'\n        });\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 处理日期选择变化\n    const handleDateChange = (event) => {\n      const newDate = event.detail.value;\n      selectedDate.value = newDate;\n      \n      const monthKey = getMonthKey(newDate);\n      const monthRequestDate = getFirstDayOfMonth(newDate);\n      \n      // 检查缓存中是否存在该月份的数据\n      if (cachedMonthData.value[monthKey]) {\n        reportData.value = cachedMonthData.value[monthKey];\n      } else {\n        fetchReport(monthRequestDate);\n      }\n    };\n\n    // 上一天\n    const prevDay = () => {\n      const prevDate = new Date(selectedDate.value);\n      prevDate.setDate(prevDate.getDate() - 1);\n      const formattedDate = prevDate.toISOString().split('T')[0];\n      \n      selectedDate.value = formattedDate;\n      const monthKey = getMonthKey(formattedDate);\n      const monthRequestDate = getFirstDayOfMonth(formattedDate);\n      \n      // 检查缓存中是否存在该月份的数据\n      if (cachedMonthData.value[monthKey]) {\n        reportData.value = cachedMonthData.value[monthKey];\n      } else {\n        fetchReport(monthRequestDate);\n      }\n    };\n\n    // 下一天\n    const nextDay = () => {\n      const nextDate = new Date(selectedDate.value);\n      nextDate.setDate(nextDate.getDate() + 1);\n      const formattedDate = nextDate.toISOString().split('T')[0];\n      \n      selectedDate.value = formattedDate;\n      const monthKey = getMonthKey(formattedDate);\n      const monthRequestDate = getFirstDayOfMonth(formattedDate);\n      \n      // 检查缓存中是否存在该月份的数据\n      if (cachedMonthData.value[monthKey]) {\n        reportData.value = cachedMonthData.value[monthKey];\n      } else {\n        fetchReport(monthRequestDate);\n      }\n    };\n\n    const isPrevDisabled = ref(false);\n    const isNextDisabled = ref(false);\n\n    // 监听 selectedDate 的变化\n    watch(selectedDate, (newDate) => {\n      isPrevDisabled.value = newDate <= '2020-01-01'; // 禁止往前选择到某个日期之前\n      isNextDisabled.value = newDate >= currentDate;\n    }, { immediate: true });\n\n    onMounted(() => {\n      // 初始化加载当前日期的数据\n      const monthKey = getMonthKey(selectedDate.value);\n      const monthRequestDate = getFirstDayOfMonth(selectedDate.value);\n      fetchReport(monthRequestDate);\n    });\n\n    const logout = () => {\n      uni.removeStorageSync('username');\n      uni.redirectTo({\n        url: '/pages/login/login'\n      });\n    };\n\n    return {\n      username,\n      reportData,\n      loading,\n      selectedDate,\n      currentDate,\n      handleDateChange,\n      prevDay,\n      nextDay,\n      isPrevDisabled,\n      isNextDisabled,\n      logout\n    };\n  }\n}\n</script>\n\n<style>\n.container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: white;\n}\n\n.content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 40rpx;\n  box-sizing: border-box;\n}\n\n.date-picker-container {\n  margin-bottom: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n}\n\n.arrow-button {\n  padding: 20rpx 30rpx;\n  border: none;\n  background-color: #007aff;\n  color: white;\n  border-radius: 10rpx;\n  margin: 0 10rpx;\n  cursor: pointer;\n  font-size: 36rpx;\n  min-width: 80rpx;\n  text-align: center;\n}\n\n.arrow-button:disabled {\n  background-color: #ccc;\n  cursor: not-allowed;\n  opacity: 0.7;\n}\n\n.picker {\n  padding: 20rpx;\n  border: 1px solid #ddd;\n  border-radius: 10rpx;\n  width: 300rpx;\n  text-align: center;\n  font-size: 32rpx;\n  background-color: #f9f9f9;\n  color: #333;\n  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.1);\n}\n\n.report-data table {\n  width: 100%;\n  border-collapse: collapse;\n  margin-top: 40rpx;\n  border: 1px solid #ddd;\n  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);\n  overflow: hidden;\n  border-radius: 12rpx;\n  background-color: #fff;\n}\n\n.report-data th, .report-data td {\n  border: 1px solid #eee;\n  padding: 24rpx 16rpx;\n  text-align: center; /* 所有内容居中 */\n  vertical-align: middle;\n  font-size: 32rpx;\n  word-break: break-all;\n  overflow-wrap: break-word;\n}\n\n.report-data th {\n  background-color: #f5f5f5;\n  font-weight: bold;\n  font-size: 34rpx;\n  padding: 24rpx 16rpx;\n  position: relative;\n}\n\n/* 设置各列宽度 */\n.report-data th:nth-child(1),\n.report-data td:nth-child(1) {\n  width: 15%; /* 区域描述 */\n  min-width: 120rpx;\n}\n\n.report-data th:nth-child(2),\n.report-data td:nth-child(2) {\n  width: 35%; /* 点检位置 */\n  min-width: 200rpx;\n}\n\n.report-data th:nth-child(3),\n.report-data td:nth-child(3) {\n  width: 15%; /* 区域负责人 */\n  min-width: 120rpx; /* 至少容纳3个汉字 */\n  white-space: nowrap; /* 防止换行 */\n}\n\n.report-data th:nth-child(4),\n.report-data td:nth-child(4) {\n  width: 15%; /* 日期列 */\n  min-width: 100rpx;\n}\n\n.check-button {\n  padding: 5rpx 10rpx;\n  border: none;\n  border-radius: 8rpx;\n  cursor: pointer;\n  background-color: transparent;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n}\n\n.check-button:hover {\n  transform: scale(1.1);\n  background-color: #e6f2ff;\n}\n\n.DuiCuo {\n  width: 36rpx;\n  height: 36rpx;\n  display: block;\n}\n\n.centered-span {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  font-weight: bold;\n  color: #666;\n}\n\n.navigator-hover {\n  opacity: 0.8;\n  background-color: #f0f0f0;\n  border-radius: 8rpx;\n}\n\n.loading {\n  margin-top: 40rpx;\n  font-size: 32rpx;\n  color: #888;\n  text-align: center;\n}\n\n.no-data {\n  margin-top: 40rpx;\n  font-size: 32rpx;\n  color: #888;\n  text-align: center;\n}\n\n/* 响应式适配小屏幕 */\n@media screen and (max-width: 768px) {\n  .report-data th, .report-data td {\n    padding: 16rpx 10rpx;\n    font-size: 28rpx;\n  }\n  \n  .picker {\n    width: 240rpx;\n    font-size: 28rpx;\n  }\n  \n  .arrow-button {\n    padding: 16rpx 20rpx;\n    font-size: 28rpx;\n  }\n}\n</style>","import MiniProgramPage from 'D:/Project/HBuilderProjects/dianjianHmS/dianjian02/pages/report/report.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","watch","onMounted"],"mappings":"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"}