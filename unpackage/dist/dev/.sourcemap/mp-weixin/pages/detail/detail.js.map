{"version":3,"file":"detail.js","sources":["pages/detail/detail.vue","../../../../Download/HBuilder-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGV0YWlsL2RldGFpbC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <navbar :username=\"username\" @logout=\"logout\"/>\r\n    <view class=\"content\">\r\n      <view v-if=\"loading\" class=\"loading\">\r\n        正在加载数据...\r\n      </view>\r\n      <view v-else-if=\"detailData && detailData.dt.length > 0\" class=\"detail-data\">\r\n        <p><strong>点检位置:</strong> {{ detailData.dt[0]['点检位置'] }}</p>\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>点检项目</th>\r\n              <th>点检内容</th>\r\n              <th colspan=\"3\">\r\n                <button class=\"arrow-button\" @click=\"prevHour\" :disabled=\"isPrevDisabled\">《</button>\r\n                {{ selectedHour }}:00\r\n                <button class=\"arrow-button\" @click=\"nextHour\" :disabled=\"isNextDisabled\">》</button>\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"(item, index) in filteredDetailData\" :key=\"index\">\r\n              <td>{{ item.点检项目 }}</td>\r\n              <td>{{ item.点检内容 }}</td>\r\n              <td>\r\n                <button\r\n                  v-if=\"item[selectedHourKey] === '1'\"\r\n                  class=\"status-button check\"\r\n                  @click=\"navigateToResult(item)\"\r\n                >\r\n                  <image src=\"../../static/whiteIcon/wDui.png\" class=\"DuiCuo\"></image>\r\n                </button>\r\n                <button \r\n                  v-else-if=\"item[selectedHourKey] === '2'\"\r\n                  class=\"status-button cross\"\r\n                  @click=\"navigateToResult(item)\"\r\n                >\r\n                  <image src=\"../../static/whiteIcon/wCuo.png\" class=\"DuiCuo\"></image>\r\n                </button>\r\n\t\t\t\t<button\r\n\t\t\t\t  v-else-if=\"item[selectedHourKey] === '3'\"\r\n\t\t\t\t  class=\"status-button quanx\"\r\n\t\t\t\t  @click=\"navigateToResult(item)\"\r\n\t\t\t\t>\r\n\t\t\t\t  <image src=\"../../static/whiteIcon/wQuanx.png\" class=\"DuiCuo\"></image>\r\n\t\t\t\t</button>\r\n                <span v-else>-</span>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </view>\r\n      <view v-else class=\"no-data\">\r\n        没有找到相关数据。\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport Navbar from '@/components/Navbar.vue';\r\n\r\nexport default {\r\n  components: {\r\n    Navbar\r\n  },\r\n  data() {\r\n    return {\r\n      username: uni.getStorageSync('username') || '',\r\n      detailData: null,\r\n      loading: true,\r\n      selectedHour: 8, // 默认时间为8点\r\n      minHour: 0,\r\n      maxHour: 23\r\n    };\r\n  },\r\n  computed: {\r\n    selectedDate() {\r\n      if (this.detailData && this.detailData.dt.length > 0) {\r\n        const firstTimestamp = Object.keys(this.detailData.dt[0]).find(key => /^202[45]-\\d{2}-\\d{2}/.test(key));\r\n        if (firstTimestamp) {\r\n          return firstTimestamp.split(' ')[0];\r\n        }\r\n      }\r\n      return '';\r\n    },\r\n    selectedHourKey() {\r\n      if (this.selectedDate) {\r\n        const key = `${this.selectedDate} ${this.selectedHour.toString().padStart(2, '0')}`;\r\n        console.log('selectedHourKey:', key); // 添加调试信息\r\n        return key;\r\n      }\r\n      return '';\r\n    },\r\n    filteredDetailData() {\r\n      if (!this.detailData || !this.detailData.dt) return [];\r\n      console.log('detailData.dt:', this.detailData.dt); // 添加调试信息\r\n      console.log('selectedHourKey in filteredDetailData:', this.selectedHourKey); // 添加调试信息\r\n      return this.detailData.dt.filter(item => item[this.selectedHourKey] !== undefined);\r\n    },\r\n    isPrevDisabled() {\r\n      return this.selectedHour <= this.minHour;\r\n    },\r\n    isNextDisabled() {\r\n      return this.selectedHour >= this.maxHour;\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchDetail(position, time) {\r\n      try {\r\n        this.loading = true;\r\n        const token = uni.getStorageSync('token');\r\n        if (!token) {\r\n          uni.showToast({\r\n            title: '未登录，请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n\r\n        const response = await uni.request({\r\n          url: 'http://13.94.38.44:8080/CheckList/GetScanReport2New',\r\n          method: 'POST',\r\n          data: {\r\n            token: token,\r\n            time: time,\r\n            Position: position\r\n          }\r\n        });\r\n\r\n        const data = JSON.parse(response.data);\r\n        if (!data.isError) {\r\n          this.detailData = data;\r\n          console.log('详细数据加载成功:', this.detailData); // 添加调试信息\r\n          this.setInitialSelectedHour();\r\n        } else {\r\n          uni.showToast({\r\n            title: '获取详细数据失败',\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('获取详细数据失败', error);\r\n        uni.showToast({\r\n          title: '获取详细数据失败',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    setInitialSelectedHour() {\r\n      if (this.detailData && this.detailData.dt.length > 0) {\r\n        const dataItem = this.detailData.dt[0];\r\n        const timestamps = Object.keys(dataItem).filter(key => /^202[45]-\\d{2}-\\d{2}/.test(key)).sort();\r\n        for (const timestamp of timestamps) {\r\n          const value = dataItem[timestamp];\r\n          if (value === '1' || value === '2') {\r\n            const hour = parseInt(timestamp.split(' ')[1], 10);\r\n            this.selectedHour = hour;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    },\r\n    prevHour() {\r\n      if (this.selectedHour > this.minHour) {\r\n        this.selectedHour--;\r\n      }\r\n    },\r\n    nextHour() {\r\n      if (this.selectedHour < this.maxHour) {\r\n        this.selectedHour++;\r\n      }\r\n    },\r\n    logout() {\r\n      uni.removeStorageSync('username');\r\n      uni.redirectTo({\r\n        url: '/pages/login/login'\r\n      });\r\n    },\r\n    navigateToResult(item) {\r\n      console.log('navigateToResult called with selectedHourKey:', this.selectedHourKey); // 添加调试信息\r\n      uni.navigateTo({\r\n        url: `/pages/result/result?position=${this.detailData.dt[0]['点检位置']}&project=${item['点检项目']}&description=${item['点检内容']}&time=${this.selectedHourKey}:00`\r\n      });\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    const position = options.position;\r\n    const time = options.time;\r\n    if (position && time) {\r\n      this.fetchDetail(decodeURIComponent(position), decodeURIComponent(time));\r\n    } else {\r\n      uni.showToast({\r\n        title: '缺少参数',\r\n        icon: 'none'\r\n      });\r\n      uni.navigateBack(); // 返回上一页\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100vh;\r\n  background-color: white;\r\n}\r\n\r\n.content {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 40rpx;\r\n}\r\n\r\n.loading {\r\n  margin-top: 40rpx;\r\n  font-size: 32rpx;\r\n  color: #888;\r\n}\r\n\r\n.no-data {\r\n  margin-top: 40rpx;\r\n  font-size: 32rpx;\r\n  color: #888;\r\n}\r\n\r\n.detail-data {\r\n  margin-top: 40rpx;\r\n  font-size: 32rpx;\r\n  color: #333;\r\n}\r\n\r\n.detail-data h2 {\r\n  font-size: 40rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.detail-data p {\r\n  margin: 10rpx 0;\r\n}\r\n\r\n.detail-data table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.detail-data th, .detail-data td {\r\n  border: 1px solid #ddd;\r\n  padding: 16rpx;\r\n  text-align: left;\r\n}\r\n\r\n.detail-data th {\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.arrow-button {\r\n  padding: 10rpx 20rpx;\r\n  border: none;\r\n  background-color: #007aff;\r\n  color: white;\r\n  border-radius: 10rpx;\r\n  margin: 0 10rpx;\r\n  cursor: pointer;\r\n}\r\n\r\n.arrow-button:disabled {\r\n  background-color: #ccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.status-button {\r\n  padding: 10rpx 20rpx;\r\n  border: none;\r\n  color: white;\r\n  border-radius: 10rpx;\r\n  margin: 0 5rpx;\r\n  cursor: pointer;\r\n}\r\n\r\n.check {\r\n  background-color: green;\r\n}\r\n\r\n.cross {\r\n  background-color: red;\r\n}\r\n\r\n.navigator-hover {\r\n  opacity: 0.8;\r\n}\r\n.DuiCuo {\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  \r\n}\r\n\r\n.quanx{\r\n\tbackground-color: orange;\r\n}\r\n\r\n</style>","import MiniProgramPage from 'D:/Project/HBuilderProjects/dianjianHmS/dianjian02/pages/detail/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}