{"version":3,"file":"scanAndNavigate.js","sources":["utils/scanAndNavigate.js"],"sourcesContent":["export function scanAndNavigate(position, loadInspectionDetails) {\r\n  uni.scanCode({\r\n    success: res => {\r\n      console.log('扫描成功', res);\r\n      verifyQRCode(res.result, position, loadInspectionDetails);\r\n    },\r\n    fail: err => {\r\n      console.error('扫描失败', err);\r\n    }\r\n  });\r\n}\r\n\r\nfunction verifyQRCode(result, position, loadInspectionDetails) {\r\n  const token = uni.getStorageSync('token'); // 获取存储的 token\r\n  uni.request({\r\n    url: 'http://13.94.38.44:8080/CheckList/GetCheckListDetailNew',\r\n    method: 'POST',\r\n    data: {\r\n      code: result.substring(0, 3), // 使用二维码的前三个字符作为代码\r\n      token: token\r\n    },\r\n    success: (res) => {\r\n      const data = JSON.parse(res.data); // 解析 JSON 数据\r\n      if (!data.isError) {\r\n        const qrCodePrefix = result.substring(0, 3).toLowerCase(); // 获取二维码的前三个字符并转换为小写\r\n        const selTxtPrefix = position.SEL_TXT.toLowerCase(); // 将传递的 SEL_TXT 转换为小写\r\n        if (qrCodePrefix === selTxtPrefix) {\r\n          uni.showToast({\r\n            title: '巡查点正确',\r\n            icon: 'success'\r\n          });\r\n          // 加载点检详情并跳转到 project 页面\r\n          loadInspectionDetails(qrCodePrefix, position);\r\n        } else {\r\n          uni.showToast({\r\n            title: '位置不匹配',\r\n            icon: 'none'\r\n          });\r\n        }\r\n      } else {\r\n        console.error('加载点检详情失败:', data.msg);\r\n        uni.showToast({\r\n          title: data.msg,\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    fail: (err) => {\r\n      console.error('加载点检详情失败', err);\r\n      uni.showToast({\r\n        title: '加载点检详情失败',\r\n        icon: 'none'\r\n      });\r\n    }\r\n  });\r\n}"],"names":["uni"],"mappings":";;AAAO,SAAS,gBAAgB,UAAU,uBAAuB;AAC/DA,gBAAAA,MAAI,SAAS;AAAA,IACX,SAAS,SAAO;AACdA,oBAAA,MAAA,MAAA,OAAA,iCAAY,QAAQ,GAAG;AACvB,mBAAa,IAAI,QAAQ,UAAU,qBAAqB;AAAA,IACzD;AAAA,IACD,MAAM,SAAO;AACXA,oBAAA,MAAA,MAAA,SAAA,iCAAc,QAAQ,GAAG;AAAA,IAC1B;AAAA,EACL,CAAG;AACH;AAEA,SAAS,aAAa,QAAQ,UAAU,uBAAuB;AAC7D,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxCA,gBAAAA,MAAI,QAAQ;AAAA,IACV,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM;AAAA,MACJ,MAAM,OAAO,UAAU,GAAG,CAAC;AAAA;AAAA,MAC3B;AAAA,IACD;AAAA,IACD,SAAS,CAAC,QAAQ;AAChB,YAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,UAAI,CAAC,KAAK,SAAS;AACjB,cAAM,eAAe,OAAO,UAAU,GAAG,CAAC,EAAE;AAC5C,cAAM,eAAe,SAAS,QAAQ,YAAW;AACjD,YAAI,iBAAiB,cAAc;AACjCA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AAED,gCAAsB,cAAc,QAAQ;AAAA,QACtD,OAAe;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AAAA,QACF;AAAA,MACT,OAAa;AACLA,sBAAA,MAAA,MAAA,SAAA,kCAAc,aAAa,KAAK,GAAG;AACnCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,KAAK;AAAA,UACZ,MAAM;AAAA,QAChB,CAAS;AAAA,MACF;AAAA,IACF;AAAA,IACD,MAAM,CAAC,QAAQ;AACbA,oBAAc,MAAA,MAAA,SAAA,kCAAA,YAAY,GAAG;AAC7BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AAAA,IACF;AAAA,EACL,CAAG;AACH;;"}